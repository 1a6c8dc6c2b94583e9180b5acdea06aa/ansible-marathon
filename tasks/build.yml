---
- name: Download sbt version {{sbt_version}}
  get_url: url={{sbt_url}} dest={{sbt_dest_file}}

- name: Install sbt for Debian
  apt: deb={{sbt_dest_file}} dpkg_options="force-depends"
  when: ansible_os_family == "Debian"

- name: Install sbt for Red Hat
  yum: name={{sbt_dest_file}}
  when: ansible_os_family == "RedHat"

- name: Clone Marathon git repo
  git: repo={{marathon_git_url}} dest={{marathon_install_location}} version={{marathon_version}}

- name: Run sbt assembly
  shell: cd {{marathon_install_location}} && sbt assembly && ./bin/build-distribution

- name: Copy compiled Marathon jar to {{marathon_install_jar}}
  command: cp {{marathon_target_jar_location}} {{marathon_install_jar}}
  notify: restart marathon